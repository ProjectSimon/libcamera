<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libcamera: libcamera::Fence Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libcamera
   &#160;<span id="projectnumber">v0.3.2+rpt20241101+6-22e19df9</span>
   </div>
   <div id="projectbrief">Supporting cameras in Linux since 2019</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacelibcamera.html">libcamera</a></li><li class="navelem"><a class="el" href="classlibcamera_1_1Fence.html">Fence</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classlibcamera_1_1Fence-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">libcamera::Fence Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Synchronization primitive to manage resources.  
 <a href="classlibcamera_1_1Fence.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ab84dac1ce57f0370012d6b278a99325a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1Fence.html#ab84dac1ce57f0370012d6b278a99325a">Fence</a> (<a class="el" href="classlibcamera_1_1UniqueFD.html">UniqueFD</a> <a class="el" href="classlibcamera_1_1Fence.html#a727b40eeec53c109922381e7eed610aa">fd</a>)</td></tr>
<tr class="memdesc:ab84dac1ce57f0370012d6b278a99325a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a>.  <a href="classlibcamera_1_1Fence.html#ab84dac1ce57f0370012d6b278a99325a">More...</a><br /></td></tr>
<tr class="separator:ab84dac1ce57f0370012d6b278a99325a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e597e352ebf6b830daf0da398dd4437"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1Fence.html#a2e597e352ebf6b830daf0da398dd4437">isValid</a> () const</td></tr>
<tr class="memdesc:a2e597e352ebf6b830daf0da398dd4437"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if a <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a> is valid.  <a href="classlibcamera_1_1Fence.html#a2e597e352ebf6b830daf0da398dd4437">More...</a><br /></td></tr>
<tr class="separator:a2e597e352ebf6b830daf0da398dd4437"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a727b40eeec53c109922381e7eed610aa"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classlibcamera_1_1UniqueFD.html">UniqueFD</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1Fence.html#a727b40eeec53c109922381e7eed610aa">fd</a> () const</td></tr>
<tr class="memdesc:a727b40eeec53c109922381e7eed610aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve a constant reference to the file descriptor.  <a href="classlibcamera_1_1Fence.html#a727b40eeec53c109922381e7eed610aa">More...</a><br /></td></tr>
<tr class="separator:a727b40eeec53c109922381e7eed610aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6fcdbbc8bb00428300d8a803702d546d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classlibcamera_1_1UniqueFD.html">UniqueFD</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1Fence.html#a6fcdbbc8bb00428300d8a803702d546d">release</a> ()</td></tr>
<tr class="memdesc:a6fcdbbc8bb00428300d8a803702d546d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release the ownership of the file descriptor.  <a href="classlibcamera_1_1Fence.html#a6fcdbbc8bb00428300d8a803702d546d">More...</a><br /></td></tr>
<tr class="separator:a6fcdbbc8bb00428300d8a803702d546d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Synchronization primitive to manage resources. </p>
<p>The <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a> class models a synchronization primitive that can be used by applications to explicitly synchronize resource usage, and can be shared by multiple processes.</p>
<p>Fences are most commonly used in association with frame buffers. A <a class="el" href="classlibcamera_1_1FrameBuffer.html" title="Frame buffer data and its associated dynamic metadata.">FrameBuffer</a> can be associated with a <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a> so that the library can wait for the <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a> to be signalled before allowing the camera device to actually access the memory area described by the <a class="el" href="classlibcamera_1_1FrameBuffer.html" title="Frame buffer data and its associated dynamic metadata.">FrameBuffer</a>.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="classlibcamera_1_1Request.html#a470cae8064c46e66367ea236dc13287d" title="Add a FrameBuffer with its associated Stream to the Request.">Request::addBuffer()</a></dd></dl>
<p>By using a fence, applications can then synchronize between frame buffer consumers and producers, as for example a display device and a camera, to guarantee that a new data transfers only happen once the existing frames have been displayed.</p>
<p>A <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a> can be realized by different event notification primitives, the most common of which is represented by waiting for read events to happen on a <a href="https://www.kernel.org/doc/html/latest/driver-api/sync_file.html">kernel sync file.</a> This is currently the only mechanism supported by libcamera, but others can be implemented by extending or subclassing this class and implementing opportune handling in the core library.</p>
<p>The <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a> class is a thin abstraction around a <a class="el" href="classlibcamera_1_1UniqueFD.html" title="unique_ptr-like wrapper for a file descriptor">UniqueFD</a> which simply allows to access it as a const reference or to move its ownership to the caller.</p>
<p>The usage of the <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a> class allows to abstract the underlying synchronization mechanism in use and implement an interface towards other library components that will not change when new synchronization primitives will be added as fences.</p>
<p>A <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a> is constructed with a <a class="el" href="classlibcamera_1_1UniqueFD.html" title="unique_ptr-like wrapper for a file descriptor">UniqueFD</a> whose ownership is moved in the <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a>. A <a class="el" href="classlibcamera_1_1FrameBuffer.html" title="Frame buffer data and its associated dynamic metadata.">FrameBuffer</a> can be associated with a <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a> by passing it to the <a class="el" href="classlibcamera_1_1Request.html#a470cae8064c46e66367ea236dc13287d" title="Add a FrameBuffer with its associated Stream to the Request.">Request::addBuffer()</a> function, which will move the <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a> into the <a class="el" href="classlibcamera_1_1FrameBuffer.html" title="Frame buffer data and its associated dynamic metadata.">FrameBuffer</a> itself. Once a <a class="el" href="classlibcamera_1_1Request.html" title="A frame capture request.">Request</a> is queued to the <a class="el" href="classlibcamera_1_1Camera.html" title="Camera device.">Camera</a>, a preparation phase guarantees that before actually applying the <a class="el" href="classlibcamera_1_1Request.html" title="A frame capture request.">Request</a> to the hardware, all the valid fences of the frame buffers in a <a class="el" href="classlibcamera_1_1Request.html" title="A frame capture request.">Request</a> are correctly signalled. Once a <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a> has completed, the library will release the <a class="el" href="classlibcamera_1_1FrameBuffer.html" title="Frame buffer data and its associated dynamic metadata.">FrameBuffer</a> fence so that application won't be allowed to access it.</p>
<p>An optional timeout can be started while waiting for a fence to complete. If waiting on a <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a> fails for whatever reason, the <a class="el" href="classlibcamera_1_1FrameBuffer.html" title="Frame buffer data and its associated dynamic metadata.">FrameBuffer</a>'s fence is not reset and is made available to application for them to handle it, by releasing the <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a> to correctly close the underlying <a class="el" href="classlibcamera_1_1UniqueFD.html" title="unique_ptr-like wrapper for a file descriptor">UniqueFD</a>.</p>
<p>A failure in waiting for a <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a> to complete will result in the <a class="el" href="classlibcamera_1_1Request.html" title="A frame capture request.">Request</a> to complete in failed state.</p>
<dl class="section see"><dt>See also</dt><dd>Request::prepare() </dd>
<dd>
PipelineHandler::doQueueRequests() </dd></dl>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ab84dac1ce57f0370012d6b278a99325a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab84dac1ce57f0370012d6b278a99325a">&#9670;&nbsp;</a></span>Fence()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">libcamera::Fence::Fence </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlibcamera_1_1UniqueFD.html">UniqueFD</a>&#160;</td>
          <td class="paramname"><em>fd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fd</td><td>The fence file descriptor</td></tr>
  </table>
  </dd>
</dl>
<p>The file descriptor ownership is moved to the <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a>. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a727b40eeec53c109922381e7eed610aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a727b40eeec53c109922381e7eed610aa">&#9670;&nbsp;</a></span>fd()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">libcamera::Fence::fd </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieve a constant reference to the file descriptor. </p>
<dl class="section return"><dt>Returns</dt><dd>A const reference to the fence file descriptor </dd></dl>

</div>
</div>
<a id="a2e597e352ebf6b830daf0da398dd4437"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e597e352ebf6b830daf0da398dd4437">&#9670;&nbsp;</a></span>isValid()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">libcamera::Fence::isValid </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if a <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a> is valid. </p>
<p>A <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a> is valid if the file descriptor it wraps is valid.</p>
<dl class="section return"><dt>Returns</dt><dd>True if the <a class="el" href="classlibcamera_1_1Fence.html" title="Synchronization primitive to manage resources.">Fence</a> is valid, false otherwise </dd></dl>

</div>
</div>
<a id="a6fcdbbc8bb00428300d8a803702d546d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6fcdbbc8bb00428300d8a803702d546d">&#9670;&nbsp;</a></span>release()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">libcamera::Fence::release </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Release the ownership of the file descriptor. </p>
<p>Release the ownership of the wrapped file descriptor by returning it to the caller.</p>
<dl class="section return"><dt>Returns</dt><dd>The wrapper <a class="el" href="classlibcamera_1_1UniqueFD.html" title="unique_ptr-like wrapper for a file descriptor">UniqueFD</a> </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/libcamera/<a class="el" href="fence_8h_source.html">fence.h</a></li>
<li>src/libcamera/fence.cpp</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
