<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libcamera: libcamera::ipa::ExposureModeHelper Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libcamera
   &#160;<span id="projectnumber">v0.3.2+rpt20241101+7-aa9d3ab4</span>
   </div>
   <div id="projectbrief">Supporting cameras in Linux since 2019</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacelibcamera.html">libcamera</a></li><li class="navelem"><a class="el" href="namespacelibcamera_1_1ipa.html">ipa</a></li><li class="navelem"><a class="el" href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html">ExposureModeHelper</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classlibcamera_1_1ipa_1_1ExposureModeHelper-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">libcamera::ipa::ExposureModeHelper Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Class for splitting exposure into shutter time and total gain.  
 <a href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a7f4eabf0963c4cfcff223ce2ae2f078e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html#a7f4eabf0963c4cfcff223ce2ae2f078e">ExposureModeHelper</a> (const Span&lt; std::pair&lt; <a class="el" href="classlibcamera_1_1utils_1_1Duration.html">utils::Duration</a>, double &gt;&gt; stages)</td></tr>
<tr class="memdesc:a7f4eabf0963c4cfcff223ce2ae2f078e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct an <a class="el" href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html" title="Class for splitting exposure into shutter time and total gain.">ExposureModeHelper</a> instance.  <a href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html#a7f4eabf0963c4cfcff223ce2ae2f078e">More...</a><br /></td></tr>
<tr class="separator:a7f4eabf0963c4cfcff223ce2ae2f078e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b7725829233c14c921f7a0cac185253"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html#a7b7725829233c14c921f7a0cac185253">setLimits</a> (<a class="el" href="classlibcamera_1_1utils_1_1Duration.html">utils::Duration</a> <a class="el" href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html#a93824fc25d14837f1f6d229b0f940891">minShutter</a>, <a class="el" href="classlibcamera_1_1utils_1_1Duration.html">utils::Duration</a> <a class="el" href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html#ab3e8a53d0cf01d803acb1a94fc7fc163">maxShutter</a>, double <a class="el" href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html#aa4834455245f11980ed6b887d3dc95ab">minGain</a>, double <a class="el" href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html#a996352f205f85833243a5cf709dff71f">maxGain</a>)</td></tr>
<tr class="memdesc:a7b7725829233c14c921f7a0cac185253"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the shutter time and gain limits.  <a href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html#a7b7725829233c14c921f7a0cac185253">More...</a><br /></td></tr>
<tr class="separator:a7b7725829233c14c921f7a0cac185253"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31ca71c05f578afb5312774dae30d1fa"><td class="memItemLeft" align="right" valign="top">std::tuple&lt; <a class="el" href="classlibcamera_1_1utils_1_1Duration.html">utils::Duration</a>, double, double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html#a31ca71c05f578afb5312774dae30d1fa">splitExposure</a> (<a class="el" href="classlibcamera_1_1utils_1_1Duration.html">utils::Duration</a> exposure) const</td></tr>
<tr class="memdesc:a31ca71c05f578afb5312774dae30d1fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Split exposure time into shutter time and gain.  <a href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html#a31ca71c05f578afb5312774dae30d1fa">More...</a><br /></td></tr>
<tr class="separator:a31ca71c05f578afb5312774dae30d1fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93824fc25d14837f1f6d229b0f940891"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classlibcamera_1_1utils_1_1Duration.html">utils::Duration</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html#a93824fc25d14837f1f6d229b0f940891">minShutter</a> () const</td></tr>
<tr class="memdesc:a93824fc25d14837f1f6d229b0f940891"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the configured minimum shutter time limit set through setShutterGainLimits()  <a href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html#a93824fc25d14837f1f6d229b0f940891">More...</a><br /></td></tr>
<tr class="separator:a93824fc25d14837f1f6d229b0f940891"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3e8a53d0cf01d803acb1a94fc7fc163"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classlibcamera_1_1utils_1_1Duration.html">utils::Duration</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html#ab3e8a53d0cf01d803acb1a94fc7fc163">maxShutter</a> () const</td></tr>
<tr class="memdesc:ab3e8a53d0cf01d803acb1a94fc7fc163"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the configured maximum shutter time set through setShutterGainLimits()  <a href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html#ab3e8a53d0cf01d803acb1a94fc7fc163">More...</a><br /></td></tr>
<tr class="separator:ab3e8a53d0cf01d803acb1a94fc7fc163"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4834455245f11980ed6b887d3dc95ab"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html#aa4834455245f11980ed6b887d3dc95ab">minGain</a> () const</td></tr>
<tr class="memdesc:aa4834455245f11980ed6b887d3dc95ab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the configured minimum gain set through setShutterGainLimits()  <a href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html#aa4834455245f11980ed6b887d3dc95ab">More...</a><br /></td></tr>
<tr class="separator:aa4834455245f11980ed6b887d3dc95ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a996352f205f85833243a5cf709dff71f"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html#a996352f205f85833243a5cf709dff71f">maxGain</a> () const</td></tr>
<tr class="memdesc:a996352f205f85833243a5cf709dff71f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the configured maximum gain set through setShutterGainLimits()  <a href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html#a996352f205f85833243a5cf709dff71f">More...</a><br /></td></tr>
<tr class="separator:a996352f205f85833243a5cf709dff71f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Class for splitting exposure into shutter time and total gain. </p>
<p>The <a class="el" href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html" title="Class for splitting exposure into shutter time and total gain.">ExposureModeHelper</a> class provides a standard interface through which an AEGC algorithm can divide exposure between shutter time and gain. It is configured with a set of shutter time and gain pairs and works by initially fixing gain at 1.0 and increasing shutter time up to the shutter time value from the first pair in the set in an attempt to meet the required exposure value.</p>
<p>If the required exposure is not achievable by the first shutter time value alone it ramps gain up to the value from the first pair in the set. If the required exposure is still not met it then allows shutter time to ramp up to the shutter time value from the second pair in the set, and continues in this vein until either the required exposure time is met, or else the hardware's shutter time or gain limits are reached.</p>
<p>This method allows users to strike a balance between a well-exposed image and an acceptable frame-rate, as opposed to simply maximising shutter time followed by gain. The same helpers can be used to perform the latter operation if needed by passing an empty set of pairs to the initialisation function.</p>
<p>The gain values may exceed a camera sensor's analogue gain limits if either it or the IPA is also capable of digital gain. The configure() function must be called with the hardware's limits to inform the helper of those constraints. Any gain that is needed will be applied as analogue gain first until the hardware's limit is reached, following which digital gain will be used. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a7f4eabf0963c4cfcff223ce2ae2f078e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f4eabf0963c4cfcff223ce2ae2f078e">&#9670;&nbsp;</a></span>ExposureModeHelper()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">libcamera::ipa::ExposureModeHelper::ExposureModeHelper </td>
          <td>(</td>
          <td class="paramtype">const Span&lt; std::pair&lt; <a class="el" href="classlibcamera_1_1utils_1_1Duration.html">utils::Duration</a>, double &gt;&gt;&#160;</td>
          <td class="paramname"><em>stages</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Construct an <a class="el" href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html" title="Class for splitting exposure into shutter time and total gain.">ExposureModeHelper</a> instance. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">stages</td><td>The vector of paired shutter time and gain limits</td></tr>
  </table>
  </dd>
</dl>
<p>The input stages are shutter time and <em>total</em> gain pairs; the gain encompasses both analogue and digital gain.</p>
<p>The vector of stages may be empty. In that case, the helper will simply use the runtime limits set through setShutterGainLimits() instead. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a996352f205f85833243a5cf709dff71f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a996352f205f85833243a5cf709dff71f">&#9670;&nbsp;</a></span>maxGain()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">libcamera::ipa::ExposureModeHelper::maxGain </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieve the configured maximum gain set through setShutterGainLimits() </p>
<dl class="section return"><dt>Returns</dt><dd>The maxGain_ value </dd></dl>

</div>
</div>
<a id="ab3e8a53d0cf01d803acb1a94fc7fc163"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3e8a53d0cf01d803acb1a94fc7fc163">&#9670;&nbsp;</a></span>maxShutter()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">libcamera::ipa::ExposureModeHelper::maxShutter </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieve the configured maximum shutter time set through setShutterGainLimits() </p>
<dl class="section return"><dt>Returns</dt><dd>The maxShutter_ value </dd></dl>

</div>
</div>
<a id="aa4834455245f11980ed6b887d3dc95ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4834455245f11980ed6b887d3dc95ab">&#9670;&nbsp;</a></span>minGain()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">libcamera::ipa::ExposureModeHelper::minGain </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieve the configured minimum gain set through setShutterGainLimits() </p>
<dl class="section return"><dt>Returns</dt><dd>The minGain_ value </dd></dl>

</div>
</div>
<a id="a93824fc25d14837f1f6d229b0f940891"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93824fc25d14837f1f6d229b0f940891">&#9670;&nbsp;</a></span>minShutter()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">libcamera::ipa::ExposureModeHelper::minShutter </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieve the configured minimum shutter time limit set through setShutterGainLimits() </p>
<dl class="section return"><dt>Returns</dt><dd>The minShutter_ value </dd></dl>

</div>
</div>
<a id="a7b7725829233c14c921f7a0cac185253"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b7725829233c14c921f7a0cac185253">&#9670;&nbsp;</a></span>setLimits()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void libcamera::ipa::ExposureModeHelper::setLimits </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlibcamera_1_1utils_1_1Duration.html">utils::Duration</a>&#160;</td>
          <td class="paramname"><em>minShutter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlibcamera_1_1utils_1_1Duration.html">utils::Duration</a>&#160;</td>
          <td class="paramname"><em>maxShutter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>minGain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>maxGain</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the shutter time and gain limits. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">minShutter</td><td>The minimum shutter time supported </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">maxShutter</td><td>The maximum shutter time supported </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">minGain</td><td>The minimum analogue gain supported </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">maxGain</td><td>The maximum analogue gain supported</td></tr>
  </table>
  </dd>
</dl>
<p>This function configures the shutter time and analogue gain limits that need to be adhered to as the helper divides up exposure. Note that this function <em>must</em> be called whenever those limits change and before <a class="el" href="classlibcamera_1_1ipa_1_1ExposureModeHelper.html#a31ca71c05f578afb5312774dae30d1fa" title="Split exposure time into shutter time and gain.">splitExposure()</a> is used.</p>
<p>If the algorithm using the helpers needs to indicate that either shutter time or analogue gain or both should be fixed it can do so by setting both the minima and maxima to the same value. </p>

</div>
</div>
<a id="a31ca71c05f578afb5312774dae30d1fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31ca71c05f578afb5312774dae30d1fa">&#9670;&nbsp;</a></span>splitExposure()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::tuple&lt; <a class="el" href="classlibcamera_1_1utils_1_1Duration.html">utils::Duration</a>, double, double &gt; libcamera::ipa::ExposureModeHelper::splitExposure </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlibcamera_1_1utils_1_1Duration.html">utils::Duration</a>&#160;</td>
          <td class="paramname"><em>exposure</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Split exposure time into shutter time and gain. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">exposure</td><td>Exposure time</td></tr>
  </table>
  </dd>
</dl>
<p>This function divides a given exposure time into shutter time, analogue and digital gain by iterating through stages of shutter time and gain limits. At each stage the current stage's shutter time limit is multiplied by the previous stage's gain limit (or 1.0 initially) to see if the combination of the two can meet the required exposure time. If they cannot then the current stage's shutter time limit is multiplied by the same stage's gain limit to see if that combination can meet the required exposure time. If they cannot then the function moves to consider the next stage.</p>
<p>When a combination of shutter time and gain <em>stage</em> limits are found that are sufficient to meet the required exposure time, the function attempts to reduce shutter time as much as possible whilst fixing gain and still meeting the exposure time. If a <em>runtime</em> limit prevents shutter time from being lowered enough to meet the exposure time with gain fixed at the stage limit, gain is also lowered to compensate.</p>
<p>Once the shutter time and gain values are ascertained, gain is assigned as analogue gain as much as possible, with digital gain only in use if the maximum analogue gain runtime limit is unable to accommodate the exposure value.</p>
<p>If no combination of shutter time and gain limits is found that meets the required exposure time, the helper falls-back to simply maximising the shutter time first, followed by analogue gain, followed by digital gain.</p>
<dl class="section return"><dt>Returns</dt><dd>Tuple of shutter time, analogue gain, and digital gain </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/ipa/libipa/<a class="el" href="exposure__mode__helper_8h_source.html">exposure_mode_helper.h</a></li>
<li>src/ipa/libipa/exposure_mode_helper.cpp</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
