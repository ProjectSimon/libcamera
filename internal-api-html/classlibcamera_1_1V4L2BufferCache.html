<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libcamera: libcamera::V4L2BufferCache Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libcamera
   &#160;<span id="projectnumber">v0.3.2+rpt20241101+7-aa9d3ab4</span>
   </div>
   <div id="projectbrief">Supporting cameras in Linux since 2019</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacelibcamera.html">libcamera</a></li><li class="navelem"><a class="el" href="classlibcamera_1_1V4L2BufferCache.html">V4L2BufferCache</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classlibcamera_1_1V4L2BufferCache-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">libcamera::V4L2BufferCache Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Hot cache of associations between V4L2 buffer indexes and <a class="el" href="classlibcamera_1_1FrameBuffer.html" title="Frame buffer data and its associated dynamic metadata.">FrameBuffer</a>.  
 <a href="classlibcamera_1_1V4L2BufferCache.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a2e85353e7d8aaeb616be5dd642830401"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1V4L2BufferCache.html#a2e85353e7d8aaeb616be5dd642830401">V4L2BufferCache</a> (unsigned int numEntries)</td></tr>
<tr class="memdesc:a2e85353e7d8aaeb616be5dd642830401"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create an empty cache with <em>numEntries</em> entries.  <a href="classlibcamera_1_1V4L2BufferCache.html#a2e85353e7d8aaeb616be5dd642830401">More...</a><br /></td></tr>
<tr class="separator:a2e85353e7d8aaeb616be5dd642830401"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a870acacffa66adfb42edc942075160de"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1V4L2BufferCache.html#a870acacffa66adfb42edc942075160de">V4L2BufferCache</a> (const std::vector&lt; std::unique_ptr&lt; <a class="el" href="classlibcamera_1_1FrameBuffer.html">FrameBuffer</a> &gt;&gt; &amp;buffers)</td></tr>
<tr class="memdesc:a870acacffa66adfb42edc942075160de"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a pre-populated cache.  <a href="classlibcamera_1_1V4L2BufferCache.html#a870acacffa66adfb42edc942075160de">More...</a><br /></td></tr>
<tr class="separator:a870acacffa66adfb42edc942075160de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e21a0ffb5ddcceef741f8469e49bb25"><td class="memItemLeft" align="right" valign="top"><a id="a4e21a0ffb5ddcceef741f8469e49bb25"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1V4L2BufferCache.html#a4e21a0ffb5ddcceef741f8469e49bb25">isEmpty</a> () const</td></tr>
<tr class="memdesc:a4e21a0ffb5ddcceef741f8469e49bb25"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if all the entries in the cache are unused. <br /></td></tr>
<tr class="separator:a4e21a0ffb5ddcceef741f8469e49bb25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d9dba272a22e92dca0dcbf55097ded3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1V4L2BufferCache.html#a3d9dba272a22e92dca0dcbf55097ded3">get</a> (const <a class="el" href="classlibcamera_1_1FrameBuffer.html">FrameBuffer</a> &amp;buffer)</td></tr>
<tr class="memdesc:a3d9dba272a22e92dca0dcbf55097ded3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the best V4L2 buffer for a <a class="el" href="classlibcamera_1_1FrameBuffer.html" title="Frame buffer data and its associated dynamic metadata.">FrameBuffer</a>.  <a href="classlibcamera_1_1V4L2BufferCache.html#a3d9dba272a22e92dca0dcbf55097ded3">More...</a><br /></td></tr>
<tr class="separator:a3d9dba272a22e92dca0dcbf55097ded3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a561f0eee632e4a465f1813abe29abdea"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1V4L2BufferCache.html#a561f0eee632e4a465f1813abe29abdea">put</a> (unsigned int index)</td></tr>
<tr class="memdesc:a561f0eee632e4a465f1813abe29abdea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mark buffer <em>index</em> as free in the cache.  <a href="classlibcamera_1_1V4L2BufferCache.html#a561f0eee632e4a465f1813abe29abdea">More...</a><br /></td></tr>
<tr class="separator:a561f0eee632e4a465f1813abe29abdea"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Hot cache of associations between V4L2 buffer indexes and <a class="el" href="classlibcamera_1_1FrameBuffer.html" title="Frame buffer data and its associated dynamic metadata.">FrameBuffer</a>. </p>
<p>When importing buffers, V4L2 performs lazy mapping of dmabuf instances at VIDIOC_QBUF (or VIDIOC_PREPARE_BUF) time and keeps the mapping associated with the V4L2 buffer, as identified by its index. If the same V4L2 buffer is then reused and queued with different dmabufs, the old dmabufs will be unmapped and the new ones mapped. To keep this process efficient, it is crucial to consistently use the same V4L2 buffer for given dmabufs through the whole duration of a capture cycle.</p>
<p>The <a class="el" href="classlibcamera_1_1V4L2BufferCache.html" title="Hot cache of associations between V4L2 buffer indexes and FrameBuffer.">V4L2BufferCache</a> class keeps a map of previous dmabufs to V4L2 buffer index associations to help selecting V4L2 buffers. It tracks, for every entry, if the V4L2 buffer is in use, and offers lookup of the best free V4L2 buffer for a set of dmabufs. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a2e85353e7d8aaeb616be5dd642830401"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e85353e7d8aaeb616be5dd642830401">&#9670;&nbsp;</a></span>V4L2BufferCache() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">libcamera::V4L2BufferCache::V4L2BufferCache </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>numEntries</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create an empty cache with <em>numEntries</em> entries. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">numEntries</td><td>Number of entries to reserve in the cache</td></tr>
  </table>
  </dd>
</dl>
<p>Create a cache with <em>numEntries</em> entries all marked as unused. The entries will be populated as the cache is used. This is typically used to implement buffer import, with buffers added to the cache as they are queued. </p>

</div>
</div>
<a id="a870acacffa66adfb42edc942075160de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a870acacffa66adfb42edc942075160de">&#9670;&nbsp;</a></span>V4L2BufferCache() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">libcamera::V4L2BufferCache::V4L2BufferCache </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::unique_ptr&lt; <a class="el" href="classlibcamera_1_1FrameBuffer.html">FrameBuffer</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>buffers</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a pre-populated cache. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">buffers</td><td>Array of buffers to pre-populated with</td></tr>
  </table>
  </dd>
</dl>
<p>Create a cache pre-populated with <em>buffers</em>. This is typically used to implement buffer export, with all buffers added to the cache when they are allocated. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a3d9dba272a22e92dca0dcbf55097ded3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d9dba272a22e92dca0dcbf55097ded3">&#9670;&nbsp;</a></span>get()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int libcamera::V4L2BufferCache::get </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlibcamera_1_1FrameBuffer.html">FrameBuffer</a> &amp;&#160;</td>
          <td class="paramname"><em>buffer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Find the best V4L2 buffer for a <a class="el" href="classlibcamera_1_1FrameBuffer.html" title="Frame buffer data and its associated dynamic metadata.">FrameBuffer</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">buffer</td><td>The <a class="el" href="classlibcamera_1_1FrameBuffer.html" title="Frame buffer data and its associated dynamic metadata.">FrameBuffer</a></td></tr>
  </table>
  </dd>
</dl>
<p>Find the best V4L2 buffer index to be used for the <a class="el" href="classlibcamera_1_1FrameBuffer.html" title="Frame buffer data and its associated dynamic metadata.">FrameBuffer</a> <em>buffer</em> based on previous mappings of frame buffers to V4L2 buffers. If a free V4L2 buffer previously used with the same dmabufs as <em>buffer</em> is found in the cache, return its index. Otherwise return the index of the first free V4L2 buffer and record its association with the dmabufs of <em>buffer</em>.</p>
<dl class="section return"><dt>Returns</dt><dd>The index of the best V4L2 buffer, or -ENOENT if no free V4L2 buffer is available </dd></dl>

</div>
</div>
<a id="a561f0eee632e4a465f1813abe29abdea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a561f0eee632e4a465f1813abe29abdea">&#9670;&nbsp;</a></span>put()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void libcamera::V4L2BufferCache::put </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>index</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mark buffer <em>index</em> as free in the cache. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">index</td><td>The V4L2 buffer index </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/libcamera/internal/<a class="el" href="v4l2__videodevice_8h_source.html">v4l2_videodevice.h</a></li>
<li>src/libcamera/v4l2_videodevice.cpp</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
